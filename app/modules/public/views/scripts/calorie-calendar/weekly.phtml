<?php 
$state = null;
if(isset($this->params['day'])) {
	if (date('d') == $this->params['day']){
		$state = 'fc-state-disabled';
	}
}

$this->calendar->build();
$prevWeek = $this->calendar->prevWeek('array');
$nextWeek = $this->calendar->nextWeek('array');

$today =  '/calorie-calendar/weekly/';
$prev = '/calorie-calendar/weekly/year/' . $prevWeek['year'] . '/month/' . $prevWeek['month'] . '/day/' . $prevWeek['day'];
$next = '/calorie-calendar/weekly/year/' . $nextWeek['year'] . '/month/' . $nextWeek['month'] . '/day/' . $nextWeek['day'];

?>

<script>
	$(function() {
		$('.fc-button-prev').bind('click', function() {
			window.top.location = '<?= $prev; ?>';
		});
		$('.fc-button-next').bind('click', function() {
			window.top.location = '<?= $next; ?>';
		});
		$('.fc-button-today').bind('click', function() {
			window.top.location = '<?= $today; ?>';
		});
		$('.fc-button-month').bind('click', function() {
			window.top.location = '<?= $this->publicUrl('monthly', 'calorie-calendar'); ?>';
		});
		$('.fc-button-agendaWeek').bind('click', function() {
			window.top.location = '<?= $this->publicUrl('weekly', 'calorie-calendar'); ?>';
		});

		<?php
			if(!isset($this->params['month'])) :
		?>
			$('.fc-button-today').addClass('fc-state-disabled');
		<?php endif; ?>
	});	
</script>

<?= $this->partial('_breadcrumbs.phtml', 
				array('t' 		  => $this->t,
					  'pageTitle' => null,
					  'page'	  => $this->t->_('Weekly Calendar'),
					  'page2'     => $this->t->_('Calorie Calendar'),
					  'page2href' => '',
	)); 
?>

<div id="page" class="dashboard">
	<div class="row-fluid">
		<div class="span12">			
			<div class="widget">
				<div class="widget-title">
					<h4><i class="icon-table"></i>
						<?php
					    	$language = new Zend_Session_Namespace('language');
					    	$config = Zend_Registry::get('config');					    	
					    	
					    	while ($day = $this->calendar->fetch()) {
					    		if(date('D',$day->thisDay(true)) == 'Mon'){
					    			if($language->lang) {
					    				if($language->lang == 'tr') {
					    					echo date('j', $day->thisDay(true));
					    					echo ' ' . $this->t->_(date('F', $day->thisDay(true))) . ' &mdash; ';
					    				}
					    				else{
					    					echo date('F j', $day->thisDay(true)) . ' &mdash; ';
					    				}
					    			}
					    			else {
					    				if($config->language->locale == 'tr') {
					    					echo date('j', $day->thisDay(true));
					    					echo ' ' . $this->t->_(date('F', $day->thisDay(true))) . ' &mdash; ';
					    				}
					    				else {
					    					echo date('F j', $day->thisDay(true)) . ' &mdash; ';
					    				}
					    			}
					    		}
					    		if(date('D',$day->thisDay(true)) == 'Sun'){
					    			if($language->lang) {
					    				if($language->lang == 'tr') {
					    					echo date('j', $day->thisDay(true));
					    					echo ' ' . $this->t->_(date('F', $day->thisDay(true)));
					    				}
					    				else{
					    					echo date('F j', $day->thisDay(true));
					    				}
					    			}
					    			else {
					    				if($config->language->locale == 'tr') {
					    					echo date('j', $day->thisDay(true));
					    					echo ' ' . $this->t->_(date('F', $day->thisDay(true)));
					    				}
					    				else {
					    					echo date('F j', $day->thisDay(true));
					    				}
					    			}
					    			
					    			echo ' ' . date('Y');
					    		}
					    	}					    	
					   	?>
					   	</h4>					   	
					<span class="tools">
	                    <a href="javascript:;" class="icon-refresh"></a>	
                    </span>											
				</div>
	<div class="widget-body">
	<div class="row-fluid">
				
	<div id="calendar" class="has-toolbar fc">
	<table class="fc-header" style="width: 100%;">
		<tbody>
			<tr>
				<td class="fc-header-left"></td>
				<td class="fc-header-center"></td>
				<td class="fc-header-right">
					<span class="fc-button fc-button-prev fc-state-default fc-corner-left"><span class="fc-button-inner"><span class="fc-button-content">&nbsp;◄&nbsp;</span><span class="fc-button-effect"><span></span></span></span></span><span class="fc-button fc-button-next fc-state-default"><span class="fc-button-inner"><span class="fc-button-content">&nbsp;►&nbsp;</span><span class="fc-button-effect"><span></span></span></span></span><span class="fc-button fc-button-today fc-state-default <?= $state; ?>"><span class="fc-button-inner"><span class="fc-button-content"><?= $this->t->_('today'); ?></span><span class="fc-button-effect"><span></span></span></span></span><span class="fc-button fc-button-month fc-state-default"><span class="fc-button-inner"><span class="fc-button-content"><?= $this->t->_('month'); ?></span><span class="fc-button-effect"><span></span></span></span></span><span class="fc-button fc-button-agendaWeek fc-state-default fc-state-active"><span class="fc-button-inner"><span class="fc-button-content"><?= $this->t->_('week'); ?></span><span class="fc-button-effect"><span></span></span></span></span>
				</td>
			</tr>
		</tbody>
	</table>	
	<div class="fc-content" style="position: relative; min-height: 1px;">
	<div class="fc-view fc-view-agendaWeek fc-agenda" style="position: relative; -moz-user-select: none; display: block;" unselectable="on">
		<table class="fc-agenda-days fc-border-separate" cellspacing="0" style="width:100%">
			<thead>
				<tr class="fc-first fc-last">
				<?php 
			    	$this->calendar->build();
			    	$language = new Zend_Session_Namespace('language');
			    	
			    	while ($day = $this->calendar->fetch()) {
			    		$config = Zend_Registry::get('config');
			    		if($language->lang) {
			    			if($language->lang == 'tr') {
				    			if(date('D', $day->thisDay(true)) == 'Mon'){
				    				echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-mon fc-widget-header fc-first dayDetail" style="width: 97px;">' . str_replace('Monday', $this->t->_('Monday'), date('j l', $day->thisDay(true))) . '</th>';
				    			}
				    			elseif(date('D', $day->thisDay(true)) == 'Sun'){
				    				echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-sun fc-widget-header fc-agenda-gutter fc-last dayDetail" style="width: 97px;">' . str_replace('Sunday', $this->t->_('Sunday'), date('j l', $day->thisDay(true))) . '</th>';
				    			}
				    			else {
				    				echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-widget-header dayDetail" style="width: 97px;">' . date('j', $day->thisDay(true)) . ' ' . $this->t->_(date('l', $day->thisDay(true))) . ' </th>';
				    			}
			    			}
			    			else {
			    				if(date('D', $day->thisDay(true)) == 'Mon'){
			    					echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-mon fc-widget-header fc-first dayDetail" style="width: 97px;">' . date('l jS', $day->thisDay(true)) . '</th>';
			    				}
			    				elseif(date('D', $day->thisDay(true)) == 'Sun'){
			    					echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-sun fc-widget-header fc-agenda-gutter fc-last dayDetail" style="width: 97px;">' . date('l jS', $day->thisDay(true)) . '</th>';
			    				}
			    				else {
			    					echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-widget-header dayDetail" style="width: 97px;">' . date('l jS', $day->thisDay(true)) . '</th>';
			    				}
			    			}
			    		}
			    		else {
			    			if($config->language->locale == 'tr') {
			    				if(date('D', $day->thisDay(true)) == 'Mon'){
				    				echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-mon fc-widget-header fc-first dayDetail" style="width: 97px;">' . str_replace('Monday', $this->t->_('Monday'), date('j l', $day->thisDay(true))) . '</th>';
				    			}
				    			elseif(date('D', $day->thisDay(true)) == 'Sun'){
				    				echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-sun fc-widget-header fc-agenda-gutter fc-last dayDetail" style="width: 97px;">' . str_replace('Sunday', $this->t->_('Sunday'), date('j l', $day->thisDay(true))) . '</th>';
				    			}
				    			else {
				    				echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-widget-header dayDetail" style="width: 97px;">' . date('j', $day->thisDay(true)) . ' ' . $this->t->_(date('l', $day->thisDay(true))) . ' </th>';
				    			}
			    			}
			    			else {
			    				if(date('D', $day->thisDay(true)) == 'Mon'){
			    					echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-mon fc-widget-header fc-first dayDetail" style="width: 97px;">' . date('l jS', $day->thisDay(true)) . '</th>';
			    				}
			    				elseif(date('D', $day->thisDay(true)) == 'Sun'){
			    					echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-sun fc-widget-header fc-agenda-gutter fc-last dayDetail" style="width: 97px;">' . date('l jS', $day->thisDay(true)) . '</th>';
			    				}
			    				else {
			    					echo '<th rel="' . $day->thisYear() . '-' . $day->thisMonth() . '-' . $day->thisDay() . '" class="fc-widget-header dayDetail" style="width: 97px;">' . date('l jS', $day->thisDay(true)) . '</th>';
			    				}
			    			}
			    		}
			    	}
			    ?>
				</tr>
			</thead>
			<tbody>
				<tr class="fc-first fc-last">
				<?php
					while ($day = $this->calendar->fetch()) {
						$modelDailyIntake = new Public_Model_Daily_Intake();
						
						$thisMonth = ((strlen($day->thisMonth()) == 1) ? '0'. $day->thisMonth() : $day->thisMonth());
						$thisDay = ((strlen($day->thisDay()) == 1) ? '0'. $day->thisDay() : $day->thisDay());
												
						$date = $day->thisYear() . '-' . $thisMonth . '-' . $thisDay;	
						
						$macros = $modelDailyIntake->fetchMacros($date, $this->user);
						
						$highlightedCss = null;
						$highlightedCss = ($date == date('Y-m-d')) ? 'fc-state-highlight' : '';
						
						if(date('D', $day->thisDay(true)) == 'Mon') {
		    	?>
		    		<td rel="<?= $date; ?>" class="fc-widget-content fc-first <?= $highlightedCss; ?>">						
				<?php
		    			} 
		    			elseif(date('D', $day->thisDay(true)) == 'Sun') {
		    	?>
    				<td rel="<?= $date; ?>" class="fc-widget-content fc-last <?= $highlightedCss; ?>">
	    		<?php 			
		    			}
		    			else {
		    	?>
		    		<td rel="<?= $day->thisYear(); ?>-<?= $day->thisMonth(); ?>-<?= $day->thisDay(); ?>" class="fc-widget-content <?= $highlightedCss; ?>">
		    	<?php 
		    		 	}
		    	?>
						<?= 
						    $this->partial('calorie-calendar/_renderWeeklyMacros.phtml',
								array('t'      => $this->t,
									  'date'   => $date,
									  'macros' => $macros
							));
						?>
					</td>
		    	<?php
		    		}
		    	?>
				</tr>
				</tbody>
			</table>
			</div>
		</div>
	</div>
</div>
</div>
</div>
</div>
</div>
</div>